<!doctype html>
<html lang="en" class="no-js">
<head>
	<meta charset="UTF-8">

<title>Ruby on Rails Plugin: data_migration</title>

<link rel="image_src" href="http://www.gravatar.com/avatar/81f0b3e0c5da01fbeb0ca3743662f070?s=100"/>
<meta property="og:image" content="http://www.gravatar.com/avatar/81f0b3e0c5da01fbeb0ca3743662f070?s=100"/>

<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">

<meta name="author" content="Heath Anderson">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="shortcut icon" href="/favicon.ico">

<link rel="stylesheet" type="text/css" media="all" href="/css/main.css">

<link rel="openid2.provider" href="https://open.login.yahooapis.com/openid/op/auth" />
<link rel="openid.server"    href="https://open.login.yahooapis.com/openid/op/auth" />

<link rel="openid2.local_id" href="http://www.flickr.com/photos/heathanderson" />
<link rel="openid.delegate"  href="http://www.flickr.com/photos/heathanderson" />

<link rel="alternate" type="application/rss+xml" title="Heath's Blog of Stuff Feed" href="http://www.heathanderson.net/atom.xml">

<link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="/css/iphone.css" type="text/css" />


</head>
<body>
  <header>
    <div class="headerWrapper">
  <div id="header">
    <a id="logo" title="Heath's Blog of Stuff" href="/"><img alt="Heath's Blog of Stuff" src="/images/logo.png"></a>
    <div id="categories_menu">
      <ul class="sf-menu sf-js-enabled">
        <li class="cat-item"><a href="/about.html">About</a></li>
  			<li class="cat-item"><a href="http://www.twitter.com/heathanderson">Twitter</a></li>
  			<li class="cat-item"><a href="http://www.facebook.com/heathanderson">Facebook</a></li>
  		</ul>
    </div>
  </div>
</div>
	</header>
	<div id="container">


		<div id="main" role="main">
      <div class="small date">Tuesday, September 22, 2009</div>
<h1>Ruby on Rails Plugin: data_migration</h1> 

<p>data_migration allows you to separate data you need to load from your normal database migrations in a minimal way. While developing the new version of our flagship site, <a href="http://www.knetwit.com">Knetwit</a>, we decided we needed to separate our data migrations (initial settings and the like) from our structural migrations. We decided the easiest way to do this was to modify the existing Rails migration to allow for a new data migration. So we did.</p>

<h3>Install Plugin</h3>

<div class="highlight"><pre><code class="ruby"> 
  <span class="n">script</span><span class="o">/</span><span class="n">plugin</span> <span class="n">install</span> <span class="n">git</span><span class="ss">:/</span><span class="o">/</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">handerson</span><span class="o">/</span><span class="n">data_migration</span><span class="o">.</span><span class="n">git</span>
</code></pre>
</div>


<h3>Generate Migration</h3>

<div class="highlight"><pre><code class="ruby"> 
  <span class="n">script</span><span class="o">/</span><span class="n">generate</span> <span class="n">data_migration</span> <span class="no">BlockedDomains</span> 
</code></pre>
</div>


<div class="highlight"><pre><code class="ruby">  <span class="n">exists</span>  <span class="n">db</span><span class="o">/</span><span class="n">data</span>
  <span class="n">create</span>  <span class="n">db</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">20090915161242</span><span class="n">_settings</span><span class="o">.</span><span class="n">rb</span><span class="o">[/</span><span class="n">sourcecode</span><span class="o">]</span>
</code></pre>
</div>


<p>db/data/20090915161242_settings.rb:</p>

<div class="highlight"><pre><code class="ruby"> 
  <span class="k">class</span> <span class="nc">BlockedDomains</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>
</div>


<p>Add your data:</p>

<div class="highlight"><pre><code class="ruby"> 
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
    <span class="no">BlockedEmailDomain</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:domain</span> <span class="o">=&gt;</span> <span class="s2">&quot;mailinator.com&quot;</span><span class="p">)</span>
    <span class="no">BlockedEmailDomain</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:domain</span> <span class="o">=&gt;</span> <span class="s2">&quot;spamherelots.com&quot;</span><span class="p">)</span>
    <span class="no">BlockedEmailDomain</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:domain</span> <span class="o">=&gt;</span> <span class="s2">&quot;disposeamail.com&quot;</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre>
</div>


<h3>Run Migration</h3>

<div class="highlight"><pre><code class="ruby">  <span class="n">rake</span> <span class="n">db</span><span class="ss">:data:migrate</span>
</code></pre>
</div>


<div class="highlight"><pre><code class="ruby"> 
  <span class="o">==</span>  <span class="no">BlockedDomains</span><span class="p">:</span> <span class="n">migrating</span> <span class="o">===========================================================</span>
  <span class="o">==</span>  <span class="no">BlockedDomains</span><span class="p">:</span> <span class="n">migrated</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mo">0020</span><span class="n">s</span><span class="p">)</span> <span class="o">==================================================</span>
</code></pre>
</div>


<p>db:data:migrate adds the data migration version number to the 'schema_migrations' table so it will not be ran again.</p>

<p>Code at Github:<br/>
<a href="http://github.com/handerson/data_migration">http://github.com/handerson/data_migration</a></p>

		



		</div>

		<footer>
      <div id="footer" class="small">
  <form onsubmit="return simpleSearch(this)" method="get" id="searchForm" style="display:none">
    <input type="search" name="q" placeholder="Search this site..." > 
    <!--[if IE ]>
    <input type="submit" value="Search">
    <![endif]-->
  </form>
  <noscript>
  	You can search this site using <a href="http://www.google.com/search?q=site:www.heathanderson.net">Google</a>.<br/>
  </noscript>

<script type="text/javascript">
function simpleSearch(form) {
  var q = window.encodeURIComponent(form["q"].value);
  var url = "http://www.google.com/search?q=site:www.heathanderson.net ";
  url = url + q;
  window.location = url;
  return false;
}

document.getElementById('searchForm').style.display = "block";
</script>

Subscribe to the <a href="/atom.xml">Atom feed</a> or <a href="http://www.twitter.com/heathanderson">follow me on twitter</a><br/>

Copyright &copy; Heath Anderson | <a href="/privacy.html">Privacy Policy</a><br/>

<a href="http://www.w3.org/html/logo/"><img src="/images/html5-badge.png" alt="HTML5 Badge" class="badge"/></a><br/>

<a title="Real Time Analytics" href="http://getclicky.com/66465306"><img alt="Real Time Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>

<script type="text/javascript">
var clicky_custom = {};
clicky_custom.cookies_disable = 1;

var clicky_site_ids = clicky_site_ids || [];
clicky_site_ids.push(66465306);
(function() {
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//static.getclicky.com/js';
  ( document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0] ).appendChild( s );
})();
</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/66465306ns.gif" /></p></noscript>

</div>



<!-- Prompt IE 6 users to install Chrome Frame. Idea from http://html5boilerplate.com.
       chromium.org/developers/how-tos/chrome-frame-getting-started -->
  <!--[if lt IE 7 ]>
    <script defer src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
    <script defer>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
  <![endif]-->

		</footer>
	</div>
</body>
</html>
